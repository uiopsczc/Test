---@class SpinLineEffectComponent:SourceTargetEffectComponent
local SpinLineEffectComponent = Class("SpinLineEffectComponent", SourceTargetEffectComponent)

---@param startPosition Vector3
---@param spinDir Vector3
---@param startSpinAngle number
---@param spinSpeed number
---@param spinLength number
---@param forwardDir Vector3
---@param forwardSpeed number
function SpinLineEffectComponent:Init(startPosition, spinDir, startSpinAngle, spinSpeed, spinLength, forwardDir, forwardSpeed)
	SpinLineEffectComponent.super.Init(self)

	self.spinSpeed = spinSpeed
	self.forwardDir = forwardDir
	self.forwardSpeed = forwardSpeed or 0
	self.spinDir = spinDir
	self.startPosition = startPosition
	self.startSpinAngle = startSpinAngle
	self.spinLength = spinLength
	self.elapsedDuration = 0

	self:Calculate(0)
	self.effectEntity:ApplyToTransformComponent(self.currentPosition, self.currentEulerAngles)
end

function SpinLineEffectComponent:Calculate(deltaTime)
	self.elapsedDuration = self.elapsedDuration + deltaTime
	local forwardDistance = self.forwardSpeed * self.elapsedDuration * self.forwardDir
	local arcDir = Quaternion.AngleAxis(self.startSpinAngle + self.spinSpeed * self.elapsedDuration, Vector3.up) * self.spinDir-- 电弧当前朝向
	self.currentPosition = self.startPosition + forwardDistance + arcDir * self.spinLength -- 电弧当前结束位置
	self.currentEulerAngles = Vector3.zero
end

return SpinLineEffectComponent