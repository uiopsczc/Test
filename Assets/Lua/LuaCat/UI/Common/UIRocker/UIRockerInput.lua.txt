-- 左右 键盘的左右键,[-1，1]
-- 下上 键盘的下上键,[-1，1]
---@class UIRockerInput:TickObject
local UIRockerInput = Class("RockerInput", TickObject)

function UIRockerInput:Init(name)
	UIRockerInput.super.Init(self)
	self.preAxis = { x = 0, y = 0 }
	self.curAxis = { x = 0, y = 0 }
	self.keyAxis = { x = 0, y = 0 }
	self.moveCooldownRemainDuration = 0
	self.name = name or ""
	self.eventNameMoveStop = self.name .. "MoveStop"
	self.eventNameMovePct = self.name .. "MovePct"
end

function UIRockerInput:__Update(deltaTime, unscaledDeltaTime)
	UIRockerInput.super.__Update(self, deltaTime, unscaledDeltaTime)
	self:__UpdateKeyInput(deltaTime, unscaledDeltaTime) -- 键盘测试用的
	if self.moveCooldownRemainDuration > 0 then
		self:__UpdateMove(deltaTime, unscaledDeltaTime)
	end
end

function UIRockerInput:__GetAxisKeyInput()
	local axisX = Input.GetAxis("Horizontal") --键盘的左右,[-1，1]
	local axisY = Input.GetAxis("Vertical")-- 键盘的上下,[-1，1]
	return axisX, axisY
end

function UIRockerInput:__UpdateKeyInput(deltaTime, unscaledDeltaTime)
	local axisX, axisY = self:__GetAxisKeyInput()
	local len = math.sqrt(axisX * axisX + axisY * axisY)
	if len == 0 then
		if not self.hasKeyPressed then
			return
		end
		self.hasKeyPressed = false
		if self.isAxisMove then
			self.keyAxis.x = axisX -- 0
			self.keyAxis.y = axisY -- 0
			self:AxisMove(0, 0)
		end
	else
		self.hasKeyPressed = true
		self.keyAxis.x = axisX
		self.keyAxis.y = axisY
		self:AxisMove(self.keyAxis.x, self.keyAxis.y)
	end
end

function UIRockerInput:AxisMove(x, y)
	self.curAxis.x = x
	self.curAxis.y = y
	if x ~= 0 or y ~= 0 then
		self:MovePct(x, y)
		self.isAxisMove = true
	elseif self.isAxisMove then
		self:MoveStop()
		self.isAxisMove = false
	end
end

function UIRockerInput:MovePct(pctX, pctY)
	self:Broadcast(self.eventNameMovePct, pctX, pctY)
end

function UIRockerInput:MoveStop()
	self.moveCooldownRemainDuration = 0
	self:Broadcast(self.eventNameMoveStop)
end

function UIRockerInput:__UpdateMove(deltaTime, unscaledDeltaTime)
	self.moveCooldownRemainDuration = self.moveCooldownRemainDuration - deltaTime
	if self.moveCooldownRemainDuration <= 0 then
		self:MovePct(self.curAxis.x, self.curAxis.y)
	end
end

return UIRockerInput